<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Async & Fetch Exercises</title>
</head>
<body>
  <h1>Exercises - Async / Await / Fetch / Promises</h1>

  <!-- ================= Exercise 1 ================= -->
  <h2>Exercise 1: Giphy API</h2>
  <button id="getGif">Get Random Gif</button>
  <div id="gifContainer"></div>
  <hr>

  <!-- ================= Exercise 2 ================= -->
  <h2>Exercise 2: Analyze Sequential Async</h2>
  <button onclick="sequentialStart()">Run Sequential</button>
  <hr>

  <!-- ================= Exercise 3 ================= -->
  <h2>Exercise 3: Analyze Concurrent Async</h2>
  <button onclick="setTimeout(concurrentStart, 1000)">Run Concurrent (delayed 1s)</button>
  <hr>

  <!-- ================= Exercise 4 ================= -->
  <h2>Exercise 4: Fetch Multiple URLs</h2>
  <button onclick="getData()">Fetch Users, Posts, Albums</button>
  <pre id="output"></pre>
  <hr>


  <script>
    /* ------------------- Exercise 1 ------------------- */
    const API_KEY = "hpvZycW22qCjn5cRM1xtWB8NKq4dQ2My"; // Provided key
    const btn = document.getElementById("getGif");
    const gifContainer = document.getElementById("gifContainer");

    btn.addEventListener("click", async () => {
      try {
        const response = await fetch(`https://api.giphy.com/v1/gifs/random?api_key=${API_KEY}`);
        if (!response.ok) {
          throw new Error("Network response was not ok");
        }
        const data = await response.json();
        const gifUrl = data.data.images.fixed_height.url;

        const img = document.createElement("img");
        img.src = gifUrl;
        img.style.margin = "10px";
        gifContainer.appendChild(img);

      } catch (error) {
        console.error("Error fetching GIF:", error);
      }
    });

    /* ------------------- Exercise 2 ------------------- */
    let resolveAfter2Seconds = function () {
      console.log("starting slow promise");
      return new Promise(resolve => {
        setTimeout(function () {
          resolve("slow");
          console.log("slow promise is done");
        }, 2000);
      });
    };

    let resolveAfter1Second = function () {
      console.log("starting fast promise");
      return new Promise(resolve => {
        setTimeout(function () {
          resolve("fast");
          console.log("fast promise is done");
        }, 1000);
      });
    };

    let sequentialStart = async function () {
      console.log('==SEQUENTIAL START==');
      const slow = await resolveAfter2Seconds(); // waits 2s
      console.log(slow);
      const fast = await resolveAfter1Second(); // waits 1s more
      console.log(fast);
    };

    /* ------------------- Exercise 3 ------------------- */
    let concurrentStart = async function () {
      console.log('==CONCURRENT START with await==');
      const slow = resolveAfter2Seconds(); // starts immediately
      const fast = resolveAfter1Second();  // starts immediately
      console.log(await slow); // prints after ~2s
      console.log(await fast); // already resolved after 1s
    };

    /* ------------------- Exercise 4 ------------------- */
    const urls = [
      "https://jsonplaceholder.typicode.com/users",
      "https://jsonplaceholder.typicode.com/posts",
      "https://jsonplaceholder.typicode.com/albums"
    ];

    const getData = async function() {
      try {
        const [ users, posts, albums ] = await Promise.all(
          urls.map(async (url) => {
            const resp = await fetch(url);
            if (!resp.ok) throw new Error("Bad response");
            return await resp.json();
          })
        );

        document.getElementById("output").textContent =
          "users:\n" + JSON.stringify(users, null, 2) +
          "\n\nposts:\n" + JSON.stringify(posts, null, 2) +
          "\n\nalbums:\n" + JSON.stringify(albums, null, 2);

      } catch (error) {
        console.log("ooooooops", error);
        document.getElementById("output").textContent = "ooooooops " + error;
      }
    };
  </script>
</body>
</html>
